import"core-js/modules/es6.array.map.js";import"core-js/modules/es6.object.keys.js";import"core-js/modules/es6.object.assign.js";import"core-js/modules/es6.array.slice.js";import"core-js/modules/es6.object.to-string.js";import"core-js/modules/es6.promise.js";import"core-js/modules/es7.promise.finally.js";import"core-js/modules/es6.array.filter.js";import"core-js/modules/es6.function.name.js";import"core-js/modules/es6.array.find.js";import t from"jquery";import"core-js/modules/es6.map.js";import"core-js/modules/es6.string.iterator.js";import"core-js/modules/es6.array.iterator.js";import"core-js/modules/web.dom.iterable.js";import"core-js/modules/es6.weak-map.js";import"core-js/modules/es6.regexp.to-string.js";function e(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function n(t,e,n){return e=s(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,u()?Reflect.construct(e,[],s(t).constructor):e.apply(t,n))}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,n){return t.get(e(t,n))}function i(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}function c(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,p(o.key),o)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e,n){return(e=p(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}function u(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(u=function(){return!!t})()}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}function p(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function m(t){var e="function"==typeof Map?new Map:void 0;return m=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(u())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,e);var r=new(t.bind.apply(t,o));return n&&f(r,n.prototype),r}(t,arguments,s(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),f(n,t)},m(t)}var v=function(){};function y(){return Object.assign.apply(Object,[{}].concat(Array.prototype.slice.call(arguments)))}function b(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var h,j={exports:{}};var g=function(){if(h)return j.exports;function t(){}return h=1,t.prototype={on:function(t,e,n){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var o=this;function r(){o.off(t,r),e.apply(n,arguments)}return r._=e,this.on(t,r,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),o=0,r=n.length;o<r;o++)n[o].fn.apply(n[o].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),o=n[t],r=[];if(o&&e)for(var i=0,c=o.length;i<c;i++)o[i].fn!==e&&o[i].fn._!==e&&r.push(o[i]);return r.length?n[t]=r:delete n[t],this}},j.exports=t,j.exports.TinyEmitter=t,j.exports}(),w="mock:success",k="mock:fail",O="mock:cancel",_="mock:realRequest",x="mock:destroyMock",P=new(b(g));function C(t){var e,n=t.scope,o=t.status,r=t.mockId;if(!n)throw new Error("scope is required");var i=null===(e=window.__MOCK_CONFIG__)||void 0===e?void 0:e.mock;o=o||"success";var c=null,a=i[n];return a&&(c=a.filter((function(t){return t.status===o})),c=r?c.find((function(t){return t.mockId===r})):c[0]),c}function M(t,e){return"".concat(t).concat(e?"-".concat(e):"")}var E=new WeakMap,I=function(){return c((function t(){if(o(this,t),i(this,E,new Map),t.instance)return t.instance;t.instance=this}),[{key:"log",value:function(){console.log(r(E,this))}},{key:"push",value:function(t,e){var n=r(E,this).get(t)||[];n.push(e),r(E,this).set(t,n)}},{key:"pop",value:function(t){var e=r(E,this).get(t)||[];if(e.length){var n=e.pop();return e.length?r(E,this).set(t,e):r(E,this).delete(t),n}}},{key:"getLatest",value:function(t){var e=r(E,this).get(t)||[];return e[e.length-1]}}])}(),S=new I;function R(t,e){var n;return P.emit(M(w,S.getLatest(t)),null===(n=C({scope:t,status:"success",mockId:e}))||void 0===n?void 0:n.data),S.pop(t)}function q(t,e){var n;return P.emit(M(k,S.getLatest(t)),null===(n=C({scope:t,status:"fail",mockId:e}))||void 0===n?void 0:n.data),S.pop(t)}function T(t){return P.emit(M(O,S.getLatest(t))),S.pop(t)}function F(t){return P.emit(M(_,S.getLatest(t))),S.pop(t)}function L(e,n){return P.emit(M(x,e||S.getLatest(n))),window.__MOCK_CONFIG__.useModal&&(t("jin-mock").attr("active","false"),t("jin-mock").last().attr("active","true")),e!==S.getLatest(n)?e:S.pop(n)}var N=new WeakMap,G=function(){function a(){var t;return o(this,a),i(t=n(this,a),N,""),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}(a,m(HTMLElement)),c(a,[{key:"connectedCallback",value:function(){var t,n,o,i=this;this.render(),t=N,n=this,o=M(x,this.id),t.set(e(t,n),o),P.on(r(N,this),(function(){P.off(r(N,i)),i.remove()}))}},{key:"disconnectedCallback",value:function(){this.innerHTML=""}},{key:"attributeChangedCallback",value:function(e,n,o){"active"===e&&t(this.shadowRoot).find(".jm-container").css({display:"true"===o?"block":"none"})}},{key:"scope",get:function(){return this._scope},set:function(t){this._scope=t}},{key:"renderDom",value:function(){var e=this,n=t('<div class="jm-container"></div>');return t(n).append(t('<div class="jm-mask"></div>\n        <div class="jm-modal">\n          <div class="jm-modal-header">\n            <h3 class="jm-modal-title">Mock 请求</h3>\n            <button class="jm-modal-close">\n              <span class="jm-modal-close-x">×</span>\n            </button>\n          </div>\n          <div class="jm-modal-body">\n          </div>\n        </div>')).find(".jm-modal-close").on("click",(function(){L(e.id,e.scope),P.off(r(N,e))})),n}},{key:"renderStyle",value:function(){return t("<style>\n      .jm-container {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        z-index: 9999;\n      }\n      .jm-mask {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.5);\n      }\n      .jm-modal {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 500px;\n        background-color: #fff;\n        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n      }\n      .jm-modal-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 10px;\n        background-color: #f5f5f5;\n      }\n      .jm-modal-title {\n        margin: 0;\n        font-size: 18px;\n      }\n      .jm-modal-close {\n        border: none;\n        background-color: transparent;\n        cursor: pointer;\n      }\n      .jm-modal-close-x {\n        font-size: 24px;\n        font-weight: bold;\n      }\n      .jm-modal-body {\n        padding: 10px;\n      }\n    </style>")}},{key:"render",value:function(){t(this.attachShadow({mode:"open"})).append(this.renderStyle()).append(this.renderDom())}}])}();a(G,"observedAttributes",["scope","id","active"]);var K=new I;function D(e){var n=t("<div>"),o=t("<h3>").text("真实的请求"),r=t("<h3>").text("成功的请求"),i=t("<h3>").text("失败的请求"),c=t("<div>"),a=t("<div>"),s=t("<div>");return c.append(t("<button>").attr("type","sendRequest").data({realRequest:!0}).text("发送请求")),a.append(function(e){var n=(window.__MOCK_CONFIG__.mock||{})[e];if(n){var o=[];return null==n||n.filter((function(t){return"success"===t.status})).forEach((function(e){var n=e.mockId,r=e.name,i=t("<button>");i.attr("type","sendRequest").data({mockId:n,status:"success"}).text(r||n),o.push(i)})),o}}(e)),s.append(function(e){var n=(window.__MOCK_CONFIG__.mock||{})[e];if(n){var o=[];return null==n||n.filter((function(t){return"fail"===t.status})).forEach((function(e){var n=e.mockId,r=e.name,i=t("<button>");i.attr("type","sendRequest").data({mockId:n,status:"fail"}).text(r||n),o.push(i)})),o}}(e)),n.on("click","button[type=sendRequest]",(function(n){var o="";"fail"===t(n.target).data("status")?o=q(e,t(n.target).data("mockId")):"success"===t(n.target).data("status")?o=R(e,t(n.target).data("mockId")):t(n.target).data("realRequest")&&(o=F(e)),L(o,e)})),n.append(o).append(c).append(r).append(a).append(i).append(s),n}function z(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:K.getLatest(e);customElements.get("jin-mock")||customElements.define("jin-mock",G);var o=t("<jin-mock></jin-mock>");return o.attr("scope",e).attr("id",n).appendTo("body"),function(e){t("jin-mock").attr("active","false"),t("jin-mock[id=".concat(e,"]")).attr("active","true")}(n),t(o.get(0).shadowRoot).find(".jm-modal-body").empty().append(D(e)),{eventId:n,close:function(){L(e)}}}var A=new I,B={realRequest:function(){return Promise.resolve()}};function H(){var t,e=y(B,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),n=e.scope,o=e.enable,r=e.realRequest;if(!n)throw new Error("scope is required");void 0===o&&(o=null===(t=window.__MOCK_CONFIG__)||void 0===t?void 0:t.enable);if(!o||o&&"object"===d(o)&&void 0!==o[n]&&!o[n])return r?r():Promise.resolve();var i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return Math.random().toString(36).slice(-t)}();A.push(n,i),window.__MOCK_CONFIG__.useModal&&z(n,i);var c=function(){P.off(M(w,i)),P.off(M(k,i)),P.off(M(O,i)),P.off(M(x,i)),P.off(M(_,i))};return new Promise((function(t,e){P.on(M(w,i),(function(e){console.log("onSuccess",e),t(e)})),P.on(M(k,i),(function(t){c(),e(t)})),P.on(M(O,i),(function(){c(),e("cancel")})),P.on(M(x,i),(function(){c(),e("close")})),P.on(M(_,i),(function(){null==r||r().then(t,e).finally((function(){c()}))}))}))}var W=["mock","enable"],J={mock:null,onSuccess:v,onFail:v,onCancel:v,useModal:!0,enable:!0},Q=function(t){var e=t.mock,n=t.enable,o=function(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n={};for(var o in t)if({}.hasOwnProperty.call(t,o)){if(e.includes(o))continue;n[o]=t[o]}return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)n=i[o],e.includes(n)||{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}(t,W);window&&("boolean"==typeof n&&n&&(n=Object.fromEntries(Object.keys(e).map((function(t){return[t,!0]})))),window.__MOCK_CONFIG__=y(window.__MOCK_CONFIG__,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({enable:n,mock:e},o)))},U=function(){return Q(y(J,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})),H};export{U as createMock,T as onCancel,L as onDestroyMock,q as onFail,F as onRealRequest,R as onSuccess};
