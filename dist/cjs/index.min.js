"use strict";require("core-js/modules/es6.array.map.js"),require("core-js/modules/es6.object.keys.js"),require("core-js/modules/es6.object.assign.js"),require("core-js/modules/es6.array.slice.js"),require("core-js/modules/es6.object.to-string.js"),require("core-js/modules/es6.promise.js"),require("core-js/modules/es7.promise.finally.js"),require("core-js/modules/es6.array.filter.js"),require("core-js/modules/es6.function.name.js"),require("core-js/modules/es6.array.find.js");var e=require("jquery");function t(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function n(e,t,n){return t=a(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,u()?Reflect.construct(t,[],a(e).constructor):t.apply(e,n))}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,n){return e.get(t(e,n))}function i(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function c(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,p(o.key),o)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function p(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function m(e){var t="function"==typeof Map?new Map:void 0;return m=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(u())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,t);var r=new(e.bind.apply(e,o));return n&&f(r,n.prototype),r}(e,arguments,a(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),f(n,e)},m(e)}require("core-js/modules/es6.map.js"),require("core-js/modules/es6.string.iterator.js"),require("core-js/modules/es6.array.iterator.js"),require("core-js/modules/web.dom.iterable.js"),require("core-js/modules/es6.weak-map.js"),require("core-js/modules/es6.regexp.to-string.js");var v=function(){};function y(){return Object.assign.apply(Object,[{}].concat(Array.prototype.slice.call(arguments)))}function b(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var h,j={exports:{}};var g=function(){if(h)return j.exports;function e(){}return h=1,e.prototype={on:function(e,t,n){var o=this.e||(this.e={});return(o[e]||(o[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var o=this;function r(){o.off(e,r),t.apply(n,arguments)}return r._=t,this.on(e,r,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),o=0,r=n.length;o<r;o++)n[o].fn.apply(n[o].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),o=n[e],r=[];if(o&&t)for(var i=0,c=o.length;i<c;i++)o[i].fn!==t&&o[i].fn._!==t&&r.push(o[i]);return r.length?n[e]=r:delete n[e],this}},j.exports=e,j.exports.TinyEmitter=e,j.exports}(),w="mock:success",k="mock:fail",O="mock:cancel",_="mock:realRequest",x="mock:destroyMock",q=new(b(g));function P(e){var t,n=e.scope,o=e.status,r=e.mockId;if(!n)throw new Error("scope is required");var i=null===(t=window.__MOCK_CONFIG__)||void 0===t?void 0:t.mock;o=o||"success";var c=null,s=i[n];return s&&(c=s.filter((function(e){return e.status===o})),c=r?c.find((function(e){return e.mockId===r})):c[0]),c}function C(e,t){return"".concat(e).concat(t?"-".concat(t):"")}var M=new WeakMap,S=function(){return c((function e(){if(o(this,e),i(this,M,new Map),e.instance)return e.instance;e.instance=this}),[{key:"log",value:function(){console.log(r(M,this))}},{key:"push",value:function(e,t){var n=r(M,this).get(e)||[];n.push(t),r(M,this).set(e,n)}},{key:"pop",value:function(e){var t=r(M,this).get(e)||[];if(t.length){var n=t.pop();return t.length?r(M,this).set(e,t):r(M,this).delete(e),n}}},{key:"getLatest",value:function(e){var t=r(M,this).get(e)||[];return t[t.length-1]}}])}(),E=new S;function I(e,t){var n;return q.emit(C(w,E.getLatest(e)),null===(n=P({scope:e,status:"success",mockId:t}))||void 0===n?void 0:n.data),E.pop(e)}function R(e,t){var n;return q.emit(C(k,E.getLatest(e)),null===(n=P({scope:e,status:"fail",mockId:t}))||void 0===n?void 0:n.data),E.pop(e)}function F(e){return q.emit(C(_,E.getLatest(e))),E.pop(e)}function T(t,n){return q.emit(C(x,t||E.getLatest(n))),window.__MOCK_CONFIG__.useModal&&(e("jin-mock").attr("active","false"),e("jin-mock").last().attr("active","true")),t!==E.getLatest(n)?t:E.pop(n)}var L=new WeakMap,N=function(){function s(){var e;return o(this,s),i(e=n(this,s),L,""),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(s,m(HTMLElement)),c(s,[{key:"connectedCallback",value:function(){var e,n,o,i=this;this.render(),e=L,n=this,o=C(x,this.id),e.set(t(e,n),o),q.on(r(L,this),(function(){q.off(r(L,i)),i.remove()}))}},{key:"disconnectedCallback",value:function(){this.innerHTML=""}},{key:"attributeChangedCallback",value:function(t,n,o){"active"===t&&e(this.shadowRoot).find(".jm-container").css({display:"true"===o?"block":"none"})}},{key:"scope",get:function(){return this._scope},set:function(e){this._scope=e}},{key:"renderDom",value:function(){var t=this,n=e('<div class="jm-container"></div>');return e(n).append(e('<div class="jm-mask"></div>\n        <div class="jm-modal">\n          <div class="jm-modal-header">\n            <h3 class="jm-modal-title">Mock 请求</h3>\n            <button class="jm-modal-close">\n              <span class="jm-modal-close-x">×</span>\n            </button>\n          </div>\n          <div class="jm-modal-body">\n          </div>\n        </div>')).find(".jm-modal-close").on("click",(function(){T(t.id,t.scope),q.off(r(L,t))})),n}},{key:"renderStyle",value:function(){return e("<style>\n      .jm-container {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        z-index: 9999;\n      }\n      .jm-mask {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.5);\n      }\n      .jm-modal {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 500px;\n        background-color: #fff;\n        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n      }\n      .jm-modal-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 10px;\n        background-color: #f5f5f5;\n      }\n      .jm-modal-title {\n        margin: 0;\n        font-size: 18px;\n      }\n      .jm-modal-close {\n        border: none;\n        background-color: transparent;\n        cursor: pointer;\n      }\n      .jm-modal-close-x {\n        font-size: 24px;\n        font-weight: bold;\n      }\n      .jm-modal-body {\n        padding: 10px;\n      }\n    </style>")}},{key:"render",value:function(){e(this.attachShadow({mode:"open"})).append(this.renderStyle()).append(this.renderDom())}}])}();s(N,"observedAttributes",["scope","id","active"]);var D=new S;function G(t){var n=e("<div>"),o=e("<h3>").text("真实的请求"),r=e("<h3>").text("成功的请求"),i=e("<h3>").text("失败的请求"),c=e("<div>"),s=e("<div>"),a=e("<div>");return c.append(e("<button>").attr("type","sendRequest").data({realRequest:!0}).text("发送请求")),s.append(function(t){var n=(window.__MOCK_CONFIG__.mock||{})[t];if(n){var o=[];return null==n||n.filter((function(e){return"success"===e.status})).forEach((function(t){var n=t.mockId,r=t.name,i=e("<button>");i.attr("type","sendRequest").data({mockId:n,status:"success"}).text(r||n),o.push(i)})),o}}(t)),a.append(function(t){var n=(window.__MOCK_CONFIG__.mock||{})[t];if(n){var o=[];return null==n||n.filter((function(e){return"fail"===e.status})).forEach((function(t){var n=t.mockId,r=t.name,i=e("<button>");i.attr("type","sendRequest").data({mockId:n,status:"fail"}).text(r||n),o.push(i)})),o}}(t)),n.on("click","button[type=sendRequest]",(function(n){var o="";"fail"===e(n.target).data("status")?o=R(t,e(n.target).data("mockId")):"success"===e(n.target).data("status")?o=I(t,e(n.target).data("mockId")):e(n.target).data("realRequest")&&(o=F(t)),T(o,t)})),n.append(o).append(c).append(r).append(s).append(i).append(a),n}function K(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D.getLatest(t);customElements.get("jin-mock")||customElements.define("jin-mock",N);var o=e("<jin-mock></jin-mock>");return o.attr("scope",t).attr("id",n).appendTo("body"),function(t){e("jin-mock").attr("active","false"),e("jin-mock[id=".concat(t,"]")).attr("active","true")}(n),e(o.get(0).shadowRoot).find(".jm-modal-body").empty().append(G(t)),{eventId:n,close:function(){T(t)}}}var z=new S,A={realRequest:function(){return Promise.resolve()}};function B(){var e,t=y(A,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),n=t.scope,o=t.enable,r=t.realRequest;if(!n)throw new Error("scope is required");void 0===o&&(o=null===(e=window.__MOCK_CONFIG__)||void 0===e?void 0:e.enable);if(!o||o&&"object"===d(o)&&void 0!==o[n]&&!o[n])return r?r():Promise.resolve();var i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return Math.random().toString(36).slice(-e)}();z.push(n,i),window.__MOCK_CONFIG__.useModal&&K(n,i);var c=function(){q.off(C(w,i)),q.off(C(k,i)),q.off(C(O,i)),q.off(C(x,i)),q.off(C(_,i))};return new Promise((function(e,t){q.on(C(w,i),(function(t){console.log("onSuccess",t),e(t)})),q.on(C(k,i),(function(e){c(),t(e)})),q.on(C(O,i),(function(){c(),t("cancel")})),q.on(C(x,i),(function(){c(),t("close")})),q.on(C(_,i),(function(){null==r||r().then(e,t).finally((function(){c()}))}))}))}var H=["mock","enable"],W={mock:null,onSuccess:v,onFail:v,onCancel:v,useModal:!0,enable:!0},J=function(e){var t=e.mock,n=e.enable,o=function(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n={};for(var o in e)if({}.hasOwnProperty.call(e,o)){if(t.includes(o))continue;n[o]=e[o]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,H);window&&("boolean"==typeof n&&n&&(n=Object.fromEntries(Object.keys(t).map((function(e){return[e,!0]})))),window.__MOCK_CONFIG__=y(window.__MOCK_CONFIG__,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({enable:n,mock:t},o)))};exports.createMock=function(){return J(y(W,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})),B},exports.onCancel=function(e){return q.emit(C(O,E.getLatest(e))),E.pop(e)},exports.onDestroyMock=T,exports.onFail=R,exports.onRealRequest=F,exports.onSuccess=I;
